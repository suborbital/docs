"use strict";(self.webpackChunksuborbital_docs=self.webpackChunksuborbital_docs||[]).push([[9341],{3905:(e,n,t)=>{t.d(n,{Zo:()=>s,kt:()=>p});var o=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,o,a=function(e,n){if(null==e)return{};var t,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)t=r[o],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)t=r[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var c=o.createContext({}),u=function(e){var n=o.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},s=function(e){var n=u(e.components);return o.createElement(c.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},m=o.forwardRef((function(e,n){var t=e.components,a=e.mdxType,r=e.originalType,c=e.parentName,s=i(e,["components","mdxType","originalType","parentName"]),m=u(t),p=a,b=m["".concat(c,".").concat(p)]||m[p]||d[p]||r;return t?o.createElement(b,l(l({ref:n},s),{},{components:t})):o.createElement(b,l({ref:n},s))}));function p(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var r=t.length,l=new Array(r);l[0]=m;var i={};for(var c in n)hasOwnProperty.call(n,c)&&(i[c]=n[c]);i.originalType=e,i.mdxType="string"==typeof e?e:a,l[1]=i;for(var u=2;u<r;u++)l[u]=t[u];return o.createElement.apply(null,l)}return o.createElement.apply(null,t)}m.displayName="MDXCreateElement"},5162:(e,n,t)=>{t.d(n,{Z:()=>l});var o=t(7294),a=t(6010);const r="tabItem_Ymn6";function l(e){let{children:n,hidden:t,className:l}=e;return o.createElement("div",{role:"tabpanel",className:(0,a.Z)(r,l),hidden:t},n)}},5488:(e,n,t)=>{t.d(n,{Z:()=>p});var o=t(7462),a=t(7294),r=t(6010),l=t(2389),i=t(7392),c=t(7094),u=t(2466);const s="tabList__CuJ",d="tabItem_LNqP";function m(e){var n,t;const{lazy:l,block:m,defaultValue:p,values:b,groupId:g,className:v}=e,f=a.Children.map(e.children,(e=>{if((0,a.isValidElement)(e)&&"value"in e.props)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),y=null!=b?b:f.map((e=>{let{props:{value:n,label:t,attributes:o}}=e;return{value:n,label:t,attributes:o}})),h=(0,i.l)(y,((e,n)=>e.value===n.value));if(h.length>0)throw new Error('Docusaurus error: Duplicate values "'+h.map((e=>e.value)).join(", ")+'" found in <Tabs>. Every value needs to be unique.');const C=null===p?p:null!=(n=null!=p?p:null==(t=f.find((e=>e.props.default)))?void 0:t.props.value)?n:f[0].props.value;if(null!==C&&!y.some((e=>e.value===C)))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+C+'" but none of its children has the corresponding value. Available values are: '+y.map((e=>e.value)).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");const{tabGroupChoices:k,setTabGroupChoices:S}=(0,c.U)(),[N,O]=(0,a.useState)(C),E=[],{blockElementScrollPositionUntilNextRender:_}=(0,u.o5)();if(null!=g){const e=k[g];null!=e&&e!==N&&y.some((n=>n.value===e))&&O(e)}const T=e=>{const n=e.currentTarget,t=E.indexOf(n),o=y[t].value;o!==N&&(_(n),O(o),null!=g&&S(g,String(o)))},A=e=>{var n;let t=null;switch(e.key){case"ArrowRight":{var o;const n=E.indexOf(e.currentTarget)+1;t=null!=(o=E[n])?o:E[0];break}case"ArrowLeft":{var a;const n=E.indexOf(e.currentTarget)-1;t=null!=(a=E[n])?a:E[E.length-1];break}}null==(n=t)||n.focus()};return a.createElement("div",{className:(0,r.Z)("tabs-container",s)},a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":m},v)},y.map((e=>{let{value:n,label:t,attributes:l}=e;return a.createElement("li",(0,o.Z)({role:"tab",tabIndex:N===n?0:-1,"aria-selected":N===n,key:n,ref:e=>E.push(e),onKeyDown:A,onFocus:T,onClick:T},l,{className:(0,r.Z)("tabs__item",d,null==l?void 0:l.className,{"tabs__item--active":N===n})}),null!=t?t:n)}))),l?(0,a.cloneElement)(f.filter((e=>e.props.value===N))[0],{className:"margin-top--md"}):a.createElement("div",{className:"margin-top--md"},f.map(((e,n)=>(0,a.cloneElement)(e,{key:n,hidden:e.props.value!==N})))))}function p(e){const n=(0,l.Z)();return a.createElement(m,(0,o.Z)({key:String(n)},e))}},8331:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>c,default:()=>p,frontMatter:()=>i,metadata:()=>u,toc:()=>d});var o=t(7462),a=(t(7294),t(3905)),r=t(5488),l=t(5162);const i={},c="Configure storage",u={unversionedId:"compute/deployment/cloud-deployment/configure-storage",id:"compute/deployment/cloud-deployment/configure-storage",title:"Configure storage",description:"By default, Compute will store compiled functions and function source code on the local storage in your Kubernetes cluster. For greater scalability, Compute can be configured to store artifacts in cloud-based object storage like Amazon S3 or Google Cloud Storage.",source:"@site/docs/compute/deployment/cloud-deployment/configure-storage.md",sourceDirName:"compute/deployment/cloud-deployment",slug:"/compute/deployment/cloud-deployment/configure-storage",permalink:"/docs/preview/compute/deployment/cloud-deployment/configure-storage",draft:!1,editUrl:"https://github.com/suborbital/docs/edit/main/website/docs/compute/deployment/cloud-deployment/configure-storage.md",tags:[],version:"current",lastUpdatedAt:1662056372,formattedLastUpdatedAt:"Sep 1, 2022",frontMatter:{},sidebar:"docs",previous:{title:"Configure capabilities",permalink:"/docs/preview/compute/deployment/cloud-deployment/configure-capabilities"},next:{title:"Configure webhooks",permalink:"/docs/preview/compute/deployment/cloud-deployment/configure-webhooks"}},s={},d=[{value:"Authentication",id:"authentication",level:2},{value:"Amazon S3",id:"amazon-s3",level:3},{value:"Google Cloud Storage",id:"google-cloud-storage",level:3},{value:"Kubernetes deployment",id:"kubernetes-deployment",level:4}],m={toc:d};function p(e){let{components:n,...t}=e;return(0,a.kt)("wrapper",(0,o.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"configure-storage"},"Configure storage"),(0,a.kt)("p",null,"By default, Compute will store compiled functions and function source code on the local storage in your Kubernetes cluster. For greater scalability, Compute can be configured to store artifacts in cloud-based object storage like Amazon S3 or Google Cloud Storage."),(0,a.kt)("h2",{id:"authentication"},"Authentication"),(0,a.kt)("p",null,"Bucket authentication varies between cloud providers."),(0,a.kt)(r.Z,{groupId:"cloud-provider",mdxType:"Tabs"},(0,a.kt)(l.Z,{value:"S3",label:"Amazon S3",mdxType:"TabItem"},(0,a.kt)("h3",{id:"amazon-s3"},"Amazon S3"),(0,a.kt)("p",null,"You will need to supply the ",(0,a.kt)("inlineCode",{parentName:"p"},"AWS_ACCESS_KEY_ID"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"AWS_SECRET_ACCESS_KEY"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"AWS_SESSION_TOKEN")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"AWS_REGION")," environment variables to the API for both the control plane and the builder. See the ",(0,a.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/sdk-for-php/v3/developer-guide/guide_credentials_environment.html"},"AWS authentication documentation")," for details. It is also possible to store the configuration as a Kubernetes secret, similar to the Google Cloud Storage configuration."),(0,a.kt)("p",null,"To configure a storage bucket, provide the ",(0,a.kt)("inlineCode",{parentName:"p"},"SCC_STORAGE_PATH")," environment variable to both the control plane and builder, e.g. ",(0,a.kt)("inlineCode",{parentName:"p"},"s3://my-bucket")," for Amazon S3 or ",(0,a.kt)("inlineCode",{parentName:"p"},"gs://my-bucket")," for Google Cloud Storage. For Kubernetes deployments, this is done in ",(0,a.kt)("inlineCode",{parentName:"p"},".suborbital/scc-controlplane-deployment.yaml")," under the ",(0,a.kt)("inlineCode",{parentName:"p"},"controlplane")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"builder")," containers sections, and for local docker-compose deployments, this is done in ",(0,a.kt)("inlineCode",{parentName:"p"},"docker-compose.yaml")," under the ",(0,a.kt)("inlineCode",{parentName:"p"},"scc-control-plane")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"scc-builder")," services."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'containers:\n  - name: controlplane\n    image: suborbital/scc-control-plane:v0.3.0\n    command: ["controlplane"]\n    \n    ports: \n      - containerPort: 8081\n    \n    env:\n      - name: SCC_HTTP_PORT        \n        value: "8081"\n        \n      - name: SCC_LOG_LEVEL\n        value: \'info\'\n        \n      - name: SCC_HEADLESS\n        value: "true"\n        \n      - name: SCC_ENV_TOKEN\n        value: <your environment token>\n      \n      - name: SCC_STORAGE_PATH\n        value: s3://your-s3-storage-bucket>\n        \n  \n  - name: builder\n    image: suborbital/scc-builder:v0.3.0\n    command: ["builder"]\n    \n    env:\n      - name: SCC_DOMAIN\n        value: "domain.example.com"\n\n      - name: SCC_TLS_PORT\n        value: "8443"\n\n      - name: SCC_LOG_LEVEL\n        value: "info"\n\n      - name:  SCC_CONTROL_PLANE\n        value: "scc-controlplane-service:8081"\n\n      - name: SCC_STORAGE_PATH\n        value: s3://your-s3-storage-bucket\n'))),(0,a.kt)(l.Z,{value:"GCS",label:"Google Cloud Storage",mdxType:"TabItem"},(0,a.kt)("h3",{id:"google-cloud-storage"},"Google Cloud Storage"),(0,a.kt)("p",null,"GCS expects to read a service account credentials file, so those credentials must be mounted. See the ",(0,a.kt)("a",{parentName:"p",href:"https://cloud.google.com/iam/docs/creating-managing-service-account-keys"},"GCP authentication documentation")," for more details."),(0,a.kt)("h4",{id:"kubernetes-deployment"},"Kubernetes deployment"),(0,a.kt)("p",null,"Create ",(0,a.kt)("inlineCode",{parentName:"p"},".suborbital/scc-gcs-credentials.yaml"),", providing the base64 encoded contents of your ",(0,a.kt)("inlineCode",{parentName:"p"},"service-account-file.json"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: v1\nkind: Secret\n\nmetadata:\n  namespace: suborbital\n  name: gcs-service-account-credentials\n\ntype: Opaque\ndata:\n  sa_json: <contents of running `base64 service-account-file.json`>\n")),(0,a.kt)("p",null,"Mount the secret and provide the ",(0,a.kt)("inlineCode",{parentName:"p"},"GOOGLE_APPLICATION_CREDENTIALS")," environment variable:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'containers:\n  - name: controlplane\n    image: suborbital/scc-control-plane:v0.3.0\n    command: ["controlplane"]\n\n    env:\n      - name: SCC_STORAGE_PATH\n        value: "gs://your-storage-bucket"\n      - name: GOOGLE_APPLICATION_CREDENTIALS\n        value: "/etc/gcp/sa_credentials.json"\n\n    volumeMounts:\n      - name: controlplane-config\n        mountPath: "/home/scn/config"\n        readOnly: true\n      - name: gcs-service-account-credentials-volume\n        mountPath: /etc/gcp\n        readOnly: true\n\n  - name: builder\n    image: suborbital/scc-builder:v0.3.0\n    command: ["builder"]\n\n    env:\n      - name: SCC_STORAGE_PATH\n        value: "gs://your-storage-bucket"\n      - name: GOOGLE_APPLICATION_CREDENTIALS\n        value: "/etc/gcp/sa_credentials.json"\n\n    volumeMounts:\n      - name: controlplane-config\n        mountPath: "/home/scn/config"\n        readOnly: true\n      - name: gcs-service-account-credentials-volume\n        mountPath: /etc/gcp\n        readOnly: true\n\nvolumes:\n  - name: scc-config\n    configMap:\n      name: scc-config\n  - name: gcs-service-account-credentials-volume\n    secret:\n      secretName: gcs-service-account-credentials\n      items:\n        - key: sa_json\n          path: sa_credentials.json\n')),(0,a.kt)("p",null,"A few things to note:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"The addition of ",(0,a.kt)("inlineCode",{parentName:"li"},"GOOGLE_APPLICATION_CREDENTIALS")," to both environments of the builder and control plane containers"),(0,a.kt)("li",{parentName:"ul"},"The ",(0,a.kt)("inlineCode",{parentName:"li"},"gcs-service-account-credentials-volume")," volume mount to the ",(0,a.kt)("inlineCode",{parentName:"li"},"volumeMounts")," sections of both containers"),(0,a.kt)("li",{parentName:"ul"},"The declaration of the volume itself in the ",(0,a.kt)("inlineCode",{parentName:"li"},"volumes")," section")))))}p.isMDXComponent=!0}}]);
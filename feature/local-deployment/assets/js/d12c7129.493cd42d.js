"use strict";(self.webpackChunksuborbital_docs=self.webpackChunksuborbital_docs||[]).push([[9341],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>m});var o=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,o,a=function(e,n){if(null==e)return{};var t,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)t=r[o],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)t=r[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var c=o.createContext({}),s=function(e){var n=o.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},u=function(e){var n=s(e.components);return o.createElement(c.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},p=o.forwardRef((function(e,n){var t=e.components,a=e.mdxType,r=e.originalType,c=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),p=s(t),m=a,g=p["".concat(c,".").concat(m)]||p[m]||d[m]||r;return t?o.createElement(g,l(l({ref:n},u),{},{components:t})):o.createElement(g,l({ref:n},u))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var r=t.length,l=new Array(r);l[0]=p;var i={};for(var c in n)hasOwnProperty.call(n,c)&&(i[c]=n[c]);i.originalType=e,i.mdxType="string"==typeof e?e:a,l[1]=i;for(var s=2;s<r;s++)l[s]=t[s];return o.createElement.apply(null,l)}return o.createElement.apply(null,t)}p.displayName="MDXCreateElement"},8331:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>d,frontMatter:()=>r,metadata:()=>i,toc:()=>s});var o=t(7462),a=(t(7294),t(3905));const r={},l="Configure storage",i={unversionedId:"compute/deployment/cloud-deployment/configure-storage",id:"compute/deployment/cloud-deployment/configure-storage",title:"Configure storage",description:"By default, Compute will store compiled functions and function source code on the local storage in your Kubernetes cluster. For greater scalability, Compute can be configured to store artifacts in cloud-based object storage like Amazon S3 or Google Cloud Storage.",source:"@site/docs/compute/deployment/cloud-deployment/configure-storage.md",sourceDirName:"compute/deployment/cloud-deployment",slug:"/compute/deployment/cloud-deployment/configure-storage",permalink:"/docs/feature/local-deployment/compute/deployment/cloud-deployment/configure-storage",draft:!1,editUrl:"https://github.com/suborbital/docs/edit/main/website/docs/compute/deployment/cloud-deployment/configure-storage.md",tags:[],version:"current",lastUpdatedAt:1660755379,formattedLastUpdatedAt:"Aug 17, 2022",frontMatter:{},sidebar:"docs",previous:{title:"Configure capabilities",permalink:"/docs/feature/local-deployment/compute/deployment/cloud-deployment/configure-capabilities"},next:{title:"Configure webhooks",permalink:"/docs/feature/local-deployment/compute/deployment/cloud-deployment/configure-webhooks"}},c={},s=[{value:"Authentication",id:"authentication",level:2},{value:"Amazon S3",id:"amazon-s3",level:3},{value:"Google Cloud Storage",id:"google-cloud-storage",level:3},{value:"Kubernetes deployment",id:"kubernetes-deployment",level:4}],u={toc:s};function d(e){let{components:n,...t}=e;return(0,a.kt)("wrapper",(0,o.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"configure-storage"},"Configure storage"),(0,a.kt)("p",null,"By default, Compute will store compiled functions and function source code on the local storage in your Kubernetes cluster. For greater scalability, Compute can be configured to store artifacts in cloud-based object storage like Amazon S3 or Google Cloud Storage."),(0,a.kt)("p",null,"To configure a storage bucket, provide the ",(0,a.kt)("inlineCode",{parentName:"p"},"SCC_STORAGE_PATH")," environment variable to both the control plane and builder, e.g. ",(0,a.kt)("inlineCode",{parentName:"p"},"s3://my-bucket")," for Amazon S3 or ",(0,a.kt)("inlineCode",{parentName:"p"},"gs://my-bucket")," for Google Cloud Storage. For Kubernetes deployments, this is done in ",(0,a.kt)("inlineCode",{parentName:"p"},".suborbital/scc-controlplane-deployment.yaml")," under the ",(0,a.kt)("inlineCode",{parentName:"p"},"controlplane")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"builder")," containers sections, and for local docker-compose deployments, this is done in ",(0,a.kt)("inlineCode",{parentName:"p"},"docker-compose.yaml")," under the ",(0,a.kt)("inlineCode",{parentName:"p"},"scc-control-plane")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"scc-builder")," services."),(0,a.kt)("h2",{id:"authentication"},"Authentication"),(0,a.kt)("p",null,"Bucket authentication varies between cloud providers."),(0,a.kt)("h3",{id:"amazon-s3"},"Amazon S3"),(0,a.kt)("p",null,"You will need to also supply the ",(0,a.kt)("inlineCode",{parentName:"p"},"AWS_ACCESS_KEY_ID"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"AWS_SECRET_ACCESS_KEY"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"AWS_SESSION_TOKEN")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"AWS_REGION")," environment variables to both the control plane and the builder. See the ",(0,a.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/sdk-for-go/api/aws/session/"},"AWS authentication documentation")," for details. It is also possible to store the configuration as a Kubernetes secret, similar to the Google Cloud Storage configuration."),(0,a.kt)("h3",{id:"google-cloud-storage"},"Google Cloud Storage"),(0,a.kt)("p",null,"GCS expects to read a service account credentials file, so those credentials must be mounted. See the ",(0,a.kt)("a",{parentName:"p",href:"https://cloud.google.com/docs/authentication/production"},"GCP authentication documentation")," for more details."),(0,a.kt)("h4",{id:"kubernetes-deployment"},"Kubernetes deployment"),(0,a.kt)("p",null,"Create ",(0,a.kt)("inlineCode",{parentName:"p"},".suborbital/scc-gcs-credentials.yaml"),", providing the base64 encoded contents of your ",(0,a.kt)("inlineCode",{parentName:"p"},"service-account-file.json"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: v1\nkind: Secret\n\nmetadata:\n  namespace: suborbital\n  name: gcs-service-account-credentials\n\ntype: Opaque\ndata:\n  sa_json: <contents of running `base64 service-account-file.json`>\n")),(0,a.kt)("p",null,"Mount the secret and provide the ",(0,a.kt)("inlineCode",{parentName:"p"},"GOOGLE_APPLICATION_CREDENTIALS")," environment variable:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'containers:\n  - name: controlplane\n    image: suborbital/scc-control-plane:v0.3.0\n    command: ["controlplane"]\n\n    env:\n      - name: SCC_STORAGE_PATH\n        value: "gs://your-storage-bucket"\n      - name: GOOGLE_APPLICATION_CREDENTIALS\n        value: "/etc/gcp/sa_credentials.json"\n\n    volumeMounts:\n      - name: controlplane-config\n        mountPath: "/home/scn/config"\n        readOnly: true\n      - name: gcs-service-account-credentials-volume\n        mountPath: /etc/gcp\n        readOnly: true\n\n  - name: builder\n    image: suborbital/scc-builder:v0.3.0\n    command: ["builder"]\n\n    env:\n      - name: SCC_STORAGE_PATH\n        value: "gs://your-storage-bucket"\n      - name: GOOGLE_APPLICATION_CREDENTIALS\n        value: "/etc/gcp/sa_credentials.json"\n\n    volumeMounts:\n      - name: controlplane-config\n        mountPath: "/home/scn/config"\n        readOnly: true\n      - name: gcs-service-account-credentials-volume\n        mountPath: /etc/gcp\n        readOnly: true\n\nvolumes:\n  - name: scc-config\n    configMap:\n      name: scc-config\n  - name: gcs-service-account-credentials-volume\n    secret:\n      secretName: gcs-service-account-credentials\n      items:\n        - key: sa_json\n          path: sa_credentials.json\n')),(0,a.kt)("p",null,"A few things to note:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"The addition of ",(0,a.kt)("inlineCode",{parentName:"li"},"GOOGLE_APPLICATION_CREDENTIALS")," to both environments of the builder and control plane containers"),(0,a.kt)("li",{parentName:"ul"},"The ",(0,a.kt)("inlineCode",{parentName:"li"},"gcs-service-account-credentials-volume")," volume mount to the ",(0,a.kt)("inlineCode",{parentName:"li"},"volumeMounts")," sections of both containers"),(0,a.kt)("li",{parentName:"ul"},"The declaration of the volume itself in the ",(0,a.kt)("inlineCode",{parentName:"li"},"volumes")," section")))}d.isMDXComponent=!0}}]);